<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <title>Festival - Project Zero</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <style>
        .content { background: #000 !important; padding: 0 !important; position: relative; display: flex; overflow: hidden; }
        #output_canvas { width: 100%; height: 100%; object-fit: contain; z-index: 5; }
        video { display: none; }
        .festival-ui { position: absolute; top: 20px; left: 20px; z-index: 10; color: #00F9C7; pointer-events: none; }
    </style>
</head>
<body>
<div class="header"><div class="title">Project Zero / é›¶è¨ˆç•«</div><div class="numbers">Festival Mode</div></div>
<div class="layout">
    <div class="sidebar">
        <a href="home.html">è‡ªä»‹</a><a href="diary.html">æ—¥è¨˜</a><a href="blog.html">éƒ¨è½æ ¼</a>
        <a href="gallery.html">ç›¸ç°¿</a><a href="collections.html">æ”¶è—</a>
        <a href="fortune.html">å¹¸é‹æŒ‡æ•¸</a><a href="festival.html">ç¯€æ…¶</a>
    </div>
    <div class="content">
        <div class="festival-ui"><h2>2025 New Year</h2><p>âœŠ æ¡æ‹³ï¼šåŒ¯èš / ğŸ–ï¸ å¼µæ‰‹ï¼šæ•£é–‹</p></div>
        <video id="input_video" playsinline></video>
        <canvas id="output_canvas"></canvas>
    </div>
</div>

<script>
    const videoElement = document.getElementById('input_video');
    const canvasElement = document.getElementById('output_canvas');
    const canvasCtx = canvasElement.getContext('2d');
    let particles = [], textPoints = [], isFist = false;
    let currentHand = { x: 0.5, y: 0.5 };

    function initText() {
        const tCanvas = document.createElement('canvas');
        const tCtx = tCanvas.getContext('2d');
        tCanvas.width = 800; tCanvas.height = 200;
        tCtx.fillStyle = "white"; tCtx.font = "bold 70px Arial";
        tCtx.textAlign = "center"; tCtx.fillText("HAPPY NEW YEAR", 400, 100);
        const data = tCtx.getImageData(0, 0, 800, 200).data;
        for (let y = 0; y < 200; y += 6) {
            for (let x = 0; x < 800; x += 6) {
                if (data[(y * 800 + x) * 4 + 3] > 128) textPoints.push({ x: x - 400, y: y - 100 });
            }
        }
    }

    class Particle {
        constructor() {
            this.x = Math.random() * 800; this.y = Math.random() * 600;
            this.v = { x: (Math.random()-0.5)*2, y: (Math.random()-0.5)*2 };
            this.color = `hsl(${Math.random()*40+160}, 100%, 70%)`;
        }
        update() {
            if (isFist) {
                let target = textPoints[particles.indexOf(this) % textPoints.length];
                this.x += (currentHand.x * canvasElement.width + target.x - this.x) * 0.1;
                this.y += (currentHand.y * canvasElement.height + target.y - this.y) * 0.1;
            } else {
                this.x += this.v.x; this.y += this.v.y;
                if(this.x<0 || this.x>canvasElement.width) this.v.x*=-1;
                if(this.y<0 || this.y>canvasElement.height) this.v.y*=-1;
            }
        }
        draw() {
            canvasCtx.fillStyle = this.color;
            canvasCtx.beginPath(); canvasCtx.arc(this.x, this.y, 2, 0, Math.PI*2); canvasCtx.fill();
        }
    }

    initText();
    for(let i=0; i<600; i++) particles.push(new Particle());

    function animate() {
        canvasElement.width = canvasElement.clientWidth;
        canvasElement.height = canvasElement.clientHeight;
        canvasCtx.fillStyle = "rgba(0,0,0,0.2)";
        canvasCtx.fillRect(0,0,canvasElement.width, canvasElement.height);
        particles.forEach(p => { p.update(); p.draw(); });
        requestAnimationFrame(animate);
    }
    animate();

    const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5, minTrackingConfidence: 0.5 });
    hands.onResults(res => {
        if (res.multiHandLandmarks && res.multiHandLandmarks.length > 0) {
            const h = res.multiHandLandmarks[0];
            const dist = Math.hypot(h[8].x - h[4].x, h[8].y - h[4].y);
            isFist = dist < 0.1;
            currentHand = { x: 1 - h[9].x, y: h[9].y };
        } else { isFist = false; }
    });

    const camera = new Camera(videoElement, {
        onFrame: async () => { await hands.send({image: videoElement}); },
        width: 1280, height: 720
    });
    camera.start().catch(() => alert("è«‹ç¢ºèªæ”å½±æ©Ÿæ¬Šé™å·²é–‹å•Ÿ"));
</script>
</body>
</html>
